Description: This lab lets users attach avatars to comments and uses the Apache Batik library to process avatar image files. To solve the lab, upload an image that displays the contents of the /etc/hostname file after processing. Then use the “Submit solution” button to submit the value of the server hostname.

Để solve được lab này thì ta phải đọc được file /etc/hostname sau đó submit cho server. Và ta sẽ sử dụng upload file để thực thi XXE. Và còn 1 hint nữa là “The SVG image format uses XML.” Do đó ta sẽ upload file SVG image gì đó.

![image](https://github.com/elliSzAt/XML-external-entity-XXE-injection/assets/125866921/c519a8ee-3f22-4e3e-a9e6-d21e037c8d54)

Bước vào lab thì ta thấy rằng đây là 1 blog. Thử View post xem sao, thì ở phần comment có xuất hiện upload file.

![image](https://github.com/elliSzAt/XML-external-entity-XXE-injection/assets/125866921/9a0f1c00-3fc9-4e36-b305-6233af039bb4)

Về 1 số loại hình tấn công XXE thông qua SVG image:

```
https://www.exploit-db.com/docs/49732
```

Nếu 1 website có thể cho người dùng upload svg file lên server thì có thể tận dụng điều này để thực hiện tấn công XXE.

SVG file là gì:

  - File SVG là một định dạng ảnh sử dụng cấu trúc XML để hiển thị ảnh dưới dạng vector.
  - SVG là viết tắt của Scalable Vector Graphics , được sử dụng để thể hiện hình ảnh đồ họa vector 2 chiều và thường được sử dụng trên các trang mạng. Ảnh có thể thu phóng một cách thoải mái và không làm giảm chất lượng bởi nó là định dạng ảnh vector. Vì thế cho nên nó được sử dụng nhiều trong các bản đồ, sơ đồ. Những tập tin có đuôi “.svg” có thể hiểu là tập SVG. SVG được quản lý bởi bởi tổ chức World Wide Web Consortium, tổ chức này cũng quản lý nhiều chuẩn khác như HTML, XHTML,…
  - SVG File định nghĩa đồ họa ở format XML, do đó nó có thể dẫn đến rất nhiều loại hình tấn công ví dụ như XSS, XXE,…

Khi ta upload 1 svg file mà không có sự xác minh kĩ càng từ phía server thì có thể thực hiện các mã độc để lấy đi thông tin nhạy cảm từ phía sever.

Tạo 1 svg file độc hại.

SVG file format bắt đầu bằng cách định nghĩa XML version trước và ta có thể include payload vào các thuộc tính chẳng hạn như chiều cao, chiều rộng, font size.

Ví dụ:

```
<?xml version="1.0" standalone="yes"?>
<!DOCTYPE test [
<!ENTITY xxe SYSTEM "file:///etc/hostname">
]>
<svg width="128px" height="128px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<text font-size="16" x="0" y="16">
&xxe;
</text>
</svg>
```

  - Dòng đầu tiên là định nghĩa xml version.
  - Dòng thứ 2 là địn nghĩa 1 thực thể bên ngoài là &fetch; có tác dụng đọc file /etc/hostname.
  - Dòng thứ 3 trở đi mở 1 thẻ <svg> để định nghĩa các thông số như chiều dài chiều rộng của ảnh. 


Lưu ý: font size của đoạn text trong file /etc/hostname. Nếu nó quá lớn hoặc quá nhỏ thì ta không thể nào đọc file được.

![image](https://github.com/elliSzAt/XML-external-entity-XXE-injection/assets/125866921/931b9ac4-0d7f-4267-87ee-6c266511b24e)

Sau khi upload file thành công thì mình check source thì nó có xuất hiện cái ảnh gì đó, có lẽ là nội dung của file /etc/hostname.

![image](https://github.com/elliSzAt/XML-external-entity-XXE-injection/assets/125866921/2ca7f638-2c64-45ad-b067-b53ed58f7967)

Nó xuất hiện 1 đoạn text trong ảnh, giờ thì mang nó đi submit để hoàn thành lab thôi.
